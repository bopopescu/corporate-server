<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE chapter [
	<!ENTITY % extensions SYSTEM "../stylesheets/macros.ent" >
	<!ENTITY % DocBookDTD PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
	"http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd">
	<!ENTITY % entities SYSTEM "../stylesheets/macros-en.ent" >
	%extensions;
	%DocBookDTD;
	%entities;
]>
<chapter id="chap:translation">
	<title>Translating UCS</title>

	<section id="misc:translation">
		<title>&ucsUMC; translations
			<indexterm><primary>Translation</primary></indexterm>
			<indexterm><primary>Localisation</primary><see>Translation</see></indexterm>
		</title>
		<remark></remark>

		<para>
			By default UCS includes English and German localizations.
			Univention provides a set of tools that facilitates the process of creating translations for &ucsUMC;.
		</para>
		<para>
			This section describes all steps necessary to create a working translation package for UCS.
			We recommend having a running UCS installation where the tools can be set up in an easy manner.
			Further more a current GIT checkout of the UCS source code is required.
		</para>

		<section id="misc:translation:preparation">
			<title>Install needed tools</title>
			<para>
				The package <package>univention-ucs-translation-template</package> contains all tools required to setup and update a translation package.
				It requires some additional Debian tools to build the package.
				Run the following command on your UCS to install all needed packages.
				<programlisting language="sh">
sudo univention-install univention-ucs-translation-template dpkg-dev git
				</programlisting>
			</para>
		</section>

		<section id="misc:translation:checkout">
			<title>Obtain a current checkout of the UCS GIT repository</title>
			<para>
				The GIT repository is later processed to get initial files for a new translation(often referred to as PO file or Portable Objects).
				<programlisting language="sh">
mkdir ~/translation
cd ~/translation
git clone \
    --single-branch --depth 1 --shallow-submodules \
    https://github.com/univention/univention-corporate-server
				</programlisting>
			</para>
		</section>

		<section id="misc:translation:createpackage">
			<title>Create a new translation package</title>
			<para>
				To create a new translation package for, e.g., French in the current working directory, the following command must be executed:
				<programlisting language="sh">
cd ~/translation
univention-ucs-translation-build-package \
    --source ~/translation/univention-corporate-server \
    --languagecode fr \
    --locale fr_FR.UTF-8:UTF-8 \
    --language-name French
				</programlisting>
				This creates a new directory <filename class="directory">~/translation/univention-l10n-fr/</filename> which contains a Debian source package of the same name.
				It includes all source and target files for the translation.
			</para>
		</section>

		<section id="misc:translation:translate">
			<title>Edit translation files</title>
			<para>
				The translation source files (<filename class="extension">.po</filename> files) are located below the directory <filename class="directory">~/translation/univention-l10n-fr/fr</filename>.
				Each file should be edited to create the translation.
			</para>
			<para>
				These files are generated by the package <package>gettext</package>.
				The manual can be found at <ulink url="https://www.gnu.org/software/gettext/manual/gettext.html"/>.
				Translation files created by <package>gettext</package> consist of a header and various entries of the form
			</para>
			<programlisting>
#: umc/app.js:637
#, python-format
msgid "The %s will expire in %d days and should be renewed!"
msgstr ""
			</programlisting>
			<para>
				The first line provides a hint, were the text is used.
				The second line is optional and contains flags, which indicate the type and state of the translation.
				The string <literal>fuzzy</literal> indicates an entry, which was copied by <package>gettext</package> from a previous version and needs to be updated.
			</para>
			<para>
				The line starting with <literal>msgid</literal> contains the original text.
				The translation has to be placed on the line containing <literal>msgstr</literal>.
				Long texts can be split over multiple lines, were each line must start and end with a double-quote.
				The following example from the German translation shows a text spanning two lines, with the placeholder present in the original and translated text.
			</para>
			<programlisting>
#: umc/js/appcenter/AppCenterPage.js:1067
#, python-format
msgid ""
"If everything else went correct and this is just a temporary network "
"problem, you should execute %s as root on that backup system."
msgstr ""
"Wenn keine weiteren Fehler auftraten und dies nur ein temporäres "
"Netzwerkproblem ist, sollten Sie %s als root auf dem Backup System ausführen."
			</programlisting>
			<para>
				Some lines contain parameters, in this example <literal>%s</literal> and <literal>%d</literal>.
				They are indicated by a flag like <literal>c-format</literal> or <literal>python-format</literal>, which must not be removed.
				The placeholders have to be carried over to the translated string unmodified and in the same order.
				Some other files contain placeholders of the form <literal>%{text}s</literal>, which are more flexible and can be reordered.
			</para>
			<para>
				After a file has been translated completely, the line containing <literal>fuzzy</literal> at the beginning of the entry should be removed to avoid warnings.
				If a translation string consists of multiple lines the translated string should roughly contain as many lines as the original string.
			</para>
		</section>

		<section id="misc:translation:updatepackage">
			<title>Update the translation package</title>
			<para>
				First update your GIT checkout:
			</para>
			<programlisting language="sh">
cd ~/translation/univention-corporate-server
git pull --rebase
			</programlisting>
			<para>
				If changes affecting translations are made in the GIT repository, existing translation packages need to be updated to reflect those changes.
				Given a path to an updated GIT checkout, <command>univention-ucs-translation-merge</command> can update a previously created translation source package.
				The following example will update the translation package <package>univention-l10n-fr/</package>:
			</para>
			<programlisting language="sh">
univention-ucs-translation-merge \
    ~/translation/univention-corporate-server \
    ~/translation/univention-l10n-fr
			</programlisting>
		</section>

		<section id="misc:translation:buildpackage">
			<title>Build the translation package</title>
			<para>
				Before using the new translation, the Debian package has to be built and installed.
				This can be done with the following commands:
			</para>
			<programlisting language="sh">
cd ~/translation/univention-l10n-fr
sudo apt-get build-dep .
dpkg-buildpackage -uc -us -b -rfakeroot
sudo dpkg -i ../univention-l10n-fr_*.deb
			</programlisting>
			<para>
				After logging out of the &ucsUMC; the new language should now be selectable in the &ucsUMC; login window.
				Untranslated strings will be still shown in their original language, i.e. in English.
			</para>
		</section>
	</section>

</chapter>
<!-- vim:set ts=2 sw=2 noet ft=docbk:-->
