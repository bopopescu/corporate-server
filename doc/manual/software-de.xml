<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE chapter [
	<!ENTITY % extensions SYSTEM "../stylesheets/macros.ent" >
	<!ENTITY % DocBookDTD PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
	"http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd">
	<!ENTITY % entities SYSTEM "../stylesheets/macros-de.ent" >
	%extensions;
	%DocBookDTD;
	%entities;
]>
<chapter id="computers::softwaremanagement">
  <title>Softwareverteilung</title>
  <section id="computers:Einfuehrung">
	<title>Einführung</title>
	<para>
	  Die in UCS integrierte Softwareverteilung bietet umfangreiche
	  Möglichkeiten für den Rollout und die Aktualisierung von UCS-Installationen.
	  Sicherheits- und Versionsupdates können über &ucsUMC;, über ein Kommandozeilen-Tool
	  und richtliniengesteuert installiert werden. Dies wird in
	  <xref linkend="software::ucs-updates"/> beschrieben. Die UCS-Softwareverteilung
	  unterstützt nicht die Aktualisierung von Microsoft Windows-Systemen.
	  Hierfür ist eine zusätzliche Windows-Softwareverteilung nötig.
	</para>

	<para>
	  Für größere Installationen besteht die Möglichkeit, einen lokalen
	  Repository-Server einzurichten, von dem aus alle weiteren Aktualisierungen
	  durchgeführt werden (siehe <xref linkend="software::configrepo"/>).
	  Dieser Repository-Server bezieht seine Pakete entweder
	  vom Univention-Online-Repository oder in Umgebungen ohne
	  Internetzugriff auch durch Offline-Updates in Form von ISO-Images.
	</para>

	<para>
	  Die UCS-Softwareverteilung basiert auf den unterliegenden
	  Debian-Paketmanagement-Tools, wird aber durch UCS-spezifische Werkzeuge
	  ergänzt. Die verschiedenen Werkzeuge zur Installation von Software werden in
	  <xref linkend="computers::softwaremanagement::installsoftware"/> vorgestellt.
	  Die Installation von Versions- und Sicherheitsupdates kann über Richtlinien
	  automatisiert werden, siehe <xref linkend="computers::softwaremanagement::maintenancepolicy"/>
	</para>

	<para>
	  Mit dem Software-Monitor steht ein Werkzeug zur Verfügung, mit dem
	  alle Paketinstallationsstände zentral in einer Datenbank erfasst
	  werden, siehe <xref linkend="computers::softwaremonitor"/>.
	</para>

	<para>
	  Die Erstinstallation von UCS-Systemen ist nicht Bestandteil dieses Kapitels,
	  sie wird stattdessen in <xref linkend="installation:chapter"/> beschrieben.
	</para>
  </section>

  <section id="computers:Unterscheidung_der_Update-Varianten_Aufbau_der_UCS-Versionen">
	<title>Unterscheidung der Update-Varianten / Aufbau der UCS-Versionen</title>
	<para>
	  Vier Arten von UCS-Updates werden unterschieden:
	</para>

	<itemizedlist>
	  <listitem><simpara>
		<emphasis>Major Releases</emphasis> erscheinen ca. alle drei bis vier Jahre. Major
		Releases können sich von vorhergehenden Major Releases signifikant hinsichtlich
		ihres Leistungsumfangs, ihrer Funktionsweise und der darin enthaltenen
		Software unterscheiden.
	  </simpara></listitem>

	  <listitem><simpara>
		Während der Maintenance-Dauer eines Major Releases erscheinen <emphasis>Minor Releases</emphasis>
		in einem Rhythmus von ca. 10-12 Monaten. Diese Updates beinhalten die Behebung
		neu bekannt gewordener Fehler, sowie die Ergänzung des
		Produkts um zusätzliche Funktionen. Dabei erhalten Minor Releases so weit wie
		möglich die Kompatibilität zu vorhergehenden Versionen hinsichtlich
		Funktionsweise, Schnittstellen und Bedienung. Sollte eine Änderung des
		Verhaltens sinnvoll oder unvermeidbar sein, so wird bei der Veröffentlichung
		der neuen Version in den Release Notes darauf hingewiesen.
	  </simpara></listitem>

	  <listitem><simpara>
		Univention veröffentlicht fortlaufend <emphasis>Errata-Updates</emphasis>. Errata-Updates
		enthalten Korrekturen für Sicherheitslücken und Bugfixes/kleinere Erweiterungen, die
		zeitnah für Kundensysteme zur Verfügung gestellt werden sollen. Eine Aufstellung aller
		Errata-Updates findet sich unter <ulink url="https://errata.software-univention.de/"/>.
	  </simpara></listitem>

	  <listitem><simpara>
		<emphasis>Patchlevel Releases</emphasis> fassen ca. alle drei Monate die bis dahin
		veröffentlichten Errata-Updates zusammen.
	  </simpara> </listitem>

	</itemizedlist>

	<para>
	  Jede ausgelieferte UCS-Version besitzt eine eindeutige Versionsbezeichnung;
	  sie besteht aus einer Zahl (der Majorversion), einem Punkt, einer zweiten Zahl (der Minorversion)
	  einem Bindestrich und einer dritten Zahl (der Patchlevelversion). Mit der
	  Version UCS 4.2-1 wird also das erste Patchlevel-Update für das zweite Minor
	  Update für das Major-Release UCS 4 bezeichnet.
	</para>

	<para>
	  Vor jedem Release-Update wird das <emphasis>Pre-update-Skript</emphasis> <filename>preup.sh</filename> aufgerufen.
	  Dieses prüft z.B. ob Probleme bestehen und bricht das Update dann kontrolliert ab.
	  Nach dem Update wird das <emphasis>Post-Update-Skript</emphasis> <filename>postup.sh</filename> aufgerufen, das ggf. weitere Aufräumarbeiten durchführt.
	</para>

	<para>
	  Errata-Updates beziehen sich immer auf bestimmte Minor-Releases, also
	  beispielsweise für UCS 4.4. Errata-Updates können in der Regel für alle
	  Patchlevelversionen eines Minor Releases installiert werden.
	</para>

	<para>
	  Wenn neue Release- oder Errata-Updates verfügbar sind, wird bei der Anmeldung
	  an &ucsUMC; ein entsprechender Hinweis ausgegeben.
	  Die Verfügbarkeit neuer Updates wird außerdem per E-Mail angekündigt,
	  entsprechende Newsletter - getrennt nach Release- und Errata-Updates - können
	  auf der Univention-Webseite abonniert werden.
	  Zu jedem Release-Update wird ein Release-Notes-Dokument veröffentlicht, in
	  dem die aktualisierten Pakete, Hinweise zu Fehlerkorrekturen und neuen
	  Funktionen aufgeführt sind.
	</para>
  </section>

  <section id="software:appcenter">
	<title>Univention App Center</title>
	<para>
	  Das Univention App Center erlaubt die einfache Einbindung von Softwarekomponenten in eine
	  UCS-Domäne. Die Applikationen werden sowohl von Drittanbietern wie auch von
	  Univention selbst (z.B. UCS@school) bereitgestellt. Die Maintenance und der
	  Support für die Applikationen erfolgt durch den jeweiligen Hersteller.
	</para>

	<figure id="appcenter-overview"><title>Überblick der verfügbaren Applikationen im App Center</title>
	<graphic scalefit="1" width="100%" fileref="illustrations44/appcenter_overview_de.png"/>
	</figure>

	<para>
	  Das Univention App Center kann über das UMC-Modul <emphasis>App Center</emphasis>
	  aufgerufen werden. Es zeigt standardmäßig alle installierten sowie verfügbare
		Softwarekomponenten an. Mit <guimenu>Suche Applikationen...</guimenu> kann die Liste der angezeigten
		Applikationen auf Suchbegriffe eingeschränkt werden. Außerdem können die Applikationen anhand
		der <guimenu>Kategorien</guimenu> gefiltert werden. Weitere Filterkriterien sind die
		<guimenu>App Badges</guimenu> und die <guimenu>App Lizenz</guimenu>. So ist auch eine
		Kombination der Filter möglich. So kann die Ansicht beispielsweise auf Applikationen aus den
		Kategorien <userinput>Bildung</userinput> oder <userinput>Office</userinput> eingeschränkt
		werden. Um hieraus dann die <foreignphrase>Recommended Apps</foreignphrase> anzuzeigen, genügt die
		Aktivierung des entsprechenden Filters.
	</para>

	<para>
		Klickt man auf eine der angezeigten Applikationen, werden weitergehende Details zu der
		Komponente angezeigt (u.a. Beschreibung, Hersteller, Ansprechpartner und Screenshots oder Videos). Im
		Feld <guimenu>Benachrichtigung</guimenu> wird angezeigt, ob der Hersteller der
		Softwarekomponente bei der Installation/Deinstallation benachrichtigt wird. Ein grobe
		Einordnung der Lizenzierung kann unter <guimenu>Lizenz</guimenu> entnommen werden. Detaillierte
		Informationen zur Lizenzierung können bei einigen Applikationen direkt über einen
		<guimenu>Kaufen</guimenu> Button bezogen werden. Für alle anderen Applikationen wird die
		Kontaktaufnahme mit dem Hersteller der Applikation über die unter <guimenu>Kontakt</guimenu>
		angezeigte E-Mail-Adresse empfohlen.
	</para>

	<figure id="appcenter-details"><title>Details einer Applikation im App Center</title>
	<graphic scalefit="1" width="100%" fileref="illustrations44/appcenter_details_de.png"/>
	</figure>

	<para>
		Mit <foreignphrase>Vote Apps</foreignphrase> gibt es eine spezielle Form von Apps im App Center, die
		nichts auf dem UCS System installieren. Hierbei handelt es sich um Apps, für die im App Center
		abgestimmt werden kann. Die Abstimmungen helfen Univention und dem potentiellen App Anbieter
		dabei, das Interesse für diese App festzustellen. <foreignphrase>Vote Apps</foreignphrase> werden in der Regel nur für einen
		begrenzten Abstimmungszeitraum angezeigt. Dass <foreignphrase>Vote Apps</foreignphrase> verfügbar sind, kann an der angezeigten
		Filteroption <guimenu>Vote Apps</guimenu> in der App Center Übersicht erkannt werden.
	</para>

	<figure id="appcenter-vote-apps"><title>Beispiel <foreignphrase>Vote Apps</foreignphrase> in App Center Übersicht und Detailansicht</title>
	<graphic scalefit="1" width="100%" fileref="illustrations44/vote_apps_de.png"/>
	</figure>

	<para>
	  Einige Applikationen sind möglicherweise inkompatibel mit anderen Softwarepaketen aus
	  UCS. So setzen beispielsweise die meisten Groupwarepakete voraus, dass der UCS-Mailstack
	  deinstalliert ist. Jede Applikation prüft, ob inkompatible Versionen installiert sind und
	  gibt einen Hinweis, welche <guimenu>Konflikte</guimenu> bestehen und wie sie beseitigt werden können. Die
	  Installation dieser Pakete wird dann zurückgehalten, bis die Konflikte beseitigt sind.
	</para>

	<para>
	  Einige Komponenten integrieren Pakete, die auf dem &ucsMaster; installiert werden müssen (in der
	  Regel LDAP-Schema-Erweiterungen oder Erweiterungen für das UCS-Managementsystem). Diese
	  Pakete werden automatisch auf dem &ucsMaster; installiert. Ist dieser nicht erreichbar,
	  wird die Installation abgebrochen. Außerdem werden die Pakete auf allen erreichbaren
	  &ucsBackup;-Systemen eingerichtet.
	  Sofern mehrere UCS Systeme in der Domäne vorhanden sind, kann ausgewählt werden, auf welchem
	  der Systeme die Applikation installiert werden soll.
	</para>

	<para>
		Einige Applikationen nutzen die Container-Technologie <application>Docker</application>.
		Dadurch wird die Applikation (und ihre unmittelbare Umgebung) vom Rest gekapselt und die Sicherheit sowie die Kompatibilität von Applikationen untereinander erhöht.
	</para>

	<para>
		Technisch wird die App als Docker Container gestartet und als &ucsMember; in die UCS Domäne
		gejoint.  Für den &ucsMember; wird im LDAP ein zugehöriges Rechner-Objekt angelegt.
	</para>

	<para>
		Der Container ist per Netzwerk nur von dem Rechner aus zu erreichen, auf dem die App installiert ist.
		Die App kann aber bestimmte Ports öffnen, die dann vom eigentlichen Rechner in den Container weitergeleitet werden.
		Die Firewall von UCS wird entsprechend automatisch konfiguriert, damit der Zugriff auf die Ports möglich ist.
	</para>

	<para>
		Wird eine Kommandozeile in der Umgebung der App benötigt, muss zunächst in den Container gewechselt werden.
		Dazu kann folgender Befehl ausgeführt werden (hier am Beispiel der fiktiven App <application>demo-docker-app</application>):
	</para>
	<programlisting language="sh">
		univention-app shell demo-docker-app
	</programlisting>
	<para>
		<wordasword>Docker Apps</wordasword> lassen sich über das UMC-Modul weiter konfigurieren.
		Die App kann gestartet und gestoppt, sowie die <guimenu>Autostart</guimenu>-Option gesetzt werden:
		<itemizedlist>
			<listitem><simpara>
					<guilabel>Automatisch gestartet</guilabel> sorgt dafür, dass die App automatisch beim Hochfahren des Servers gestartet wird.
			</simpara></listitem>
			<listitem><simpara>
					<guilabel>Manuell gestartet</guilabel> verhindert den automatischen Start der App, sie kann aber über das UMC-Modul gestartet werden.
			</simpara></listitem>
			<listitem><simpara>
					<guilabel>Start wird verhindert</guilabel> unterbindet grundsätzlich den Start der App; sie kann dann auch nicht über das UMC-Modul gestartet werden.
			</simpara></listitem>
		</itemizedlist>
		Darüber hinaus können Apps ggf. über weitere Parameter angepasst werden.
		Das Menü dafür ist über den Button <guibutton>App-Einstellungen</guibutton> einer installierten App zu erreichen.
	</para>

	<figure id="appcenter-configure"><title>Einstellungen einer Applikation im App Center</title>
	<graphic scalefit="1" width="90%" align="center" fileref="illustrations44/appcenter_configure_de.png"/>
	</figure>

	<para>
	  Nach der Installation einer Applikation werden beim Klick auf das Icon einer Applikation
	  eine oder mehrere neue Optionen angezeigt: <guimenu>Deinstallieren</guimenu> entfernt eine Applikation.
	  <guimenu>Öffnen</guimenu> verweist auf eine Webseite oder ein UMC-Modul, mit dem die installierte Applikation
	  weitergehend konfiguriert oder verwendet werden kann. Installiert man beispielsweise die
	  Horde-Applikation, führt dieser Link auf den Login-Dialog. Bei Applikationen ohne
	  Webinterface oder UMC-Modul wird die Option nicht angezeigt.
	</para>

	<para>
	  Aktualisierungen für Applikationen erfolgen unabhängig von den Release-Zyklen für
	  &ucsUCS;. Ist eine neue Version einer Applikation verfügbar, wird der Menüpunkt
	  <guimenu>Aktualisieren</guimenu> angezeigt, der die Installation der neuen Version
	  startet. Wenn Aktualisierungen verfügbar sind, wird außerdem im UMC-Modul <guimenu>Software-Aktualisierung</guimenu>
	  &ucsUMC; ein entsprechender Hinweis ausgegeben.
	</para>

	<para>
	  Eine Übersicht über die installierten Applikationen in der Domäne kann auf der UMC-Startseite
	  unter <guimenu>Installierte Applikationen</guimenu> abgerufen werden.
	  Installationen und das Entfernen von Paketen werden in der Logdatei
	  <filename>/var/log/univention/management-console-module-appcenter.log</filename>
	  protokolliert.
	</para>

  </section>

  <section id="software::ucs-updates">
	<title>Aktualisierung von UCS-Systemen</title>
	<para>
	  UCS-Systeme können auf zwei Wegen aktualisiert werden; entweder pro einzelnem System
	  (über &ucsUMC; oder auf der Kommandozeile) oder für größere Gruppen von
	  UCS-Systemen automatisiert über eine UMC-Rechner-Richtlinie.
	</para>

	<section id="computers:Update-Strategie_in_Umgebungen_mit_mehr_als_einem_UCS-System">
	  <title>Update-Strategie in Umgebungen mit mehr als einem UCS-System</title>
	  <para>
		In Umgebungen mit mehr als einem UCS-System muss die
		Update-Reihenfolge der UCS-Systeme beachtet werden:
	  </para>

	  <para>
		Auf dem &ucsMaster; wird die authoritative Version des
		LDAP-Verzeichnisdienstes vorgehalten, die an alle übrigen LDAP-Server
		der UCS-Domäne repliziert wird. Da bei Release-Updates Veränderungen
		an den LDAP-Schemata auftreten können (siehe <xref linkend="domain:ldap:schemata"/>) muss der &ucsMaster;
		bei einem Release-Update immer als erstes System aktualisiert werden.
	  </para>

	  <para>
		Generell ist es empfehlenswert, alle UCS-Systeme möglichst in einem
		Wartungsfenster zu aktualisieren. Wo dies nicht möglich ist, sollten
		die nicht-aktualisierten UCS-Systeme gegenüber dem &ucsMaster; nur
		eine Release-Version älter sein.
	  </para>

	</section>

	<section id="computers:Aktualisierung_eines_einzelnen_Systems_in_der_UMC">
	  <title>Aktualisierung eines einzelnen Systems in &ucsUMC;</title>
	  <para>
		Mit dem UMC-Modul <guimenu>Software-Aktualisierung</guimenu> können Versions- und
		Errata-Updates installiert werden.
	  </para>

	  <para>
		In <xref linkend="software-umcupdate"/> ist die Übersichtsseite des
		Moduls dargestellt. Im oberen Teil des Dialogs wird unter
		<guimenu>Release-Aktualisierungen</guimenu> der aktuelle Installationsstand
		angezeigt.
	  </para>

	  <figure id="software-umcupdate"><title>Aktualisierung eines UCS-Systems über UMC</title>
	  <graphic scalefit="1" width="100%" fileref="illustrations44/software_onlineupdate_de.png"/>
	  </figure>

	  <para>
		Sollte eine neuere UCS-Version vorhanden sein, wird eine Auswahlliste
		präsentiert. Durch einen Klick auf <guimenu>Release-Aktualisierungen installieren</guimenu>
		werden nach Bestätigung alle Updates bis zur jeweiligen Version eingespielt. Zuvor wird ein Hinweis auf mögliche
		Einschränkungen der Serverdienste während des Updates angezeigt. Eventuelle
		Zwischenversionen werden automatisch mitinstalliert.
	  </para>

	  <para>
		Durch einen Klick auf <guimenu>Errata-Aktualisierungen
		installieren</guimenu> werden alle für das aktuelle Release und die
		eingebundenen Komponenten verfügbaren Errata-Updates eingerichtet.
	  </para>

	  <para>
		Mit <guimenu>Paket-Aktualisierungen prüfen</guimenu> wird eine Aktualisierung der momentan
		eingetragenen Paketquellen aktiviert. Dies kann etwa verwendet werden, wenn
		für eine Komponente eine aktualisierte Version bereitgestellt wurde.
	  </para>

	  <para>
		Die während der Aktualisierung erzeugten Meldungen werden in die
		Datei <filename>/var/log/univention/updater.log</filename> geschrieben.
	  </para>
	</section>

	<section id="computers:Aktualisierung_eines_einzelnen_Systems_auf_der_Kommandozeile">
	  <title>Aktualisierung eines einzelnen Systems auf der Kommandozeile</title>
	  <para>
		Die folgenden Schritte müssen mit <systemitem class="username">root</systemitem>-Rechten durchgeführt werden.
	  </para>

	  <para>
		Ein einzelnes UCS-System kann auf der Kommandozeile mit dem Befehl
		<command>univention-upgrade</command> aktualisiert werden. Es wird geprüft, ob neue
		Release oder Applikations-Updates vorliegen, die dann nach Bestätigung einer Nachfrage installiert
		werden. Außerdem werden Paket-Aktualisierungen durchgeführt (z.B. im Rahmen
		eines Errata-Updates).
	  </para>

	  <para>
		In der Grundeinstellung werden die zu aktualisierenden Pakete über das
		Netz aus einem Repository geladen. Wird ein lokales Repository
		eingesetzt (siehe <xref linkend="software::createrepo"/>), können
		Release-Updates alternativ auch über Update-DVD-Images installiert werden, die
		entweder als ISO-Datei oder von einem Laufwerk eingelesen werden.
		Dazu muss <command>univention-upgrade</command> mit den Parametern
		<option>--iso=<replaceable>ISOIMAGEDATEI</replaceable></option> oder
		<option>--cdrom=<replaceable>LAUFWERK</replaceable></option> aufgerufen werden.
	  </para>

	  <para>
		Von einer Remote-Aktualisierung über SSH wird abgeraten, da dies zum
		Abbruch des Update-Vorgangs führen kann. Sollte dennoch eine Aktualisierung
		über eine Netzverbindung durchgeführt werden, ist
		sicherzustellen, dass das Update bei Unterbrechung der Netzverbindung
		trotzdem weiterläuft. Hierfür können beispielsweise die Tools
		<command>screen</command> oder <command>at</command> eingesetzt werden, die auf
		allen Systemrollen installiert sind.
	  </para>

	  <para>
		Die während der Aktualisierung erzeugten Meldungen werden in die
		Datei <filename>/var/log/univention/updater.log</filename> geschrieben.
	  </para>
	</section>

	<section id="computers::softwaremanagement::releasepolicy">
	  <title>Aktualisierung von Systemen über eine Rechner-Richtlinie</title>
	  <para>
		Mit einer <guimenu>Automatische Updates</guimenu>-Richtlinien in den
		UMC-Modulen zur Rechner- und Domänenverwaltung lässt sich ein Update für
		mehrere Rechner konfigurieren (siehe auch <xref linkend="central:policies"/>).
	  </para>

	  <figure id="software-policyupdate"><title>Aktualisierung eines UCS-Systems über eine Update-Richtlinie</title>
	  <graphic scalefit="1" width="100%" fileref="illustrations44/software_policy_de.png"/>
	  </figure>

	  <para>
		Nur wenn das Auswahlfeld <guimenu>Aktiviere Release-Updates</guimenu>
		aktiviert ist, wird eine Release-Aktualisierung durchgeführt.
	  </para>

	  <para>
		Das Eingabefeld <guimenu>Bis zu dieser UCS-Version aktualisieren</guimenu> enthält die
		Versionsnummer, bis zu der das System aktualisiert werden soll,
		z.B. <emphasis>4.4-0</emphasis>. Wird keine Angabe gemacht, aktualisiert sich das
		System bis zur höchsten verfügbaren Versionsnummer.
	  </para>

	  <para>
		Der Zeitpunkt, zu dem die Aktualisierung durchgeführt wird, wird über
		eine <guimenu>Paketpflege</guimenu>-Richtlinie konfiguriert (siehe
		<xref linkend="computers::softwaremanagement::maintenancepolicy"/>).
	  </para>

	  <para>
		Die während der Aktualisierung erzeugten Meldungen werden in die
		Datei <filename>/var/log/univention/updater.log</filename> geschrieben.
	  </para>
	</section>

	<section id="computers:Nachbereitung_von_Release-Updates">
	  <title>Nachbereitung von Release-Updates</title>
	  <para>
		Nach erfolgreicher Durchführung eines Release-Updates sollte geprüft
		werden, ob neue oder aktualisierte Join-Skripte ausgeführt werden
		müssen. Zur Überprüfung und zum Starten der Join-Skripte kann
		entweder das UMC-Modul <emphasis>Domänenbeitritt</emphasis> verwendet werden
		oder das Kommandozeilenprogramm
		<command>univention-run-join-scripts</command> (siehe
		<xref linkend="linux-domaenenbeitritt"/>).
	  </para>
	</section>

	<section id="computers:troubleshooting">
	  <title>Fehlersuche bei Updateproblemen</title>
	  <para>
		Die während der Aktualisierung erzeugten Meldungen werden in die Datei
		<filename>/var/log/univention/updater.log</filename> geschrieben, die zur weiteren
		Fehleranalyse herangezogen werden kann.
	  </para>

	  <para>
		Der Stand der &ucsUCR;-Variablen vor der Release-Aktualisierung wird in dem Verzeichnis
		<filename class="directory">/var/univention-backup/update-to-ZIELRELEASEVERSION/</filename>
		gesichert. Damit kann geprüft werden, ob und welche Variablen im Rahmen des Updates
		verändert wurden.
	  </para>
	</section>
  </section>

  <section id="software::configrepo">
	<title>Konfiguration des Repository-Servers für Updates und Paketinstallationen</title>
	<para>
	  Paketinstallationen und Updates können entweder vom Univention-Update-Server
	  oder von einem lokal gepflegten Repository durchgeführt werden. Ein lokales
	  Repository ist sinnvoll, wenn viele UCS-Systeme zu aktualisieren sind, da
	  Updates in diesem Fall nur einmalig heruntergeladen werden müssen. Da
	  Repositorys auch offline aktualisiert werden können, ermöglicht ein lokales
	  Repository auch die Aktualisierung von UCS-Umgebungen ohne Internetanbindung.
	</para>

	<para>
	  Anhand der registrierten Einstellungen werden APT-Paketquellen für Release- und
	  Errata-Updates sowie Addon-Komponenten im Verzeichnis
	  <filename class="directory">/etc/apt/sources.list.d/</filename> automatisch generiert.
	  Sollten auf einem System weitere Repositorys benötigt werden, können diese in
	  die Datei <filename>/etc/apt/sources.list</filename> eingetragen werden.
	</para>

	<para>
	  Bei einer Neuinstallation wird in der Grundeinstellung das
	  Univention-Repository <uri>updates.software-univention.de</uri> verwendet.
	</para>

	<para>
	  Das Univention-Repository und andere Repository-Komponenten unterscheiden
	  zwischen zwei Bestandteilen:
	</para>

	<itemizedlist>
	  <listitem><simpara>
		Der von der Maintenance abgedeckte Standard-Paketumfang von UCS
		befindet sich im <emphasis>maintained</emphasis>-Bereich. Standardmäßig ist nur der
		Zugriff auf diese Pakete aktiviert. Sicherheits-Updates werden zeitnah
		nur für Pakete aus <emphasis>maintained</emphasis> bereitgestellt.
	  </simpara></listitem>

	  <listitem><simpara>
		Unter <emphasis>unmaintained</emphasis> finden sich die weiteren Pakete,
		z.B. andere Mailserver als Postfix. Diese Pakete sind nicht durch
		Sicherheits-Updates oder anderweitige Maintenance
		abgedeckt. <emphasis>unmaintained</emphasis> ist standardmäßig nicht eingebunden
	  </simpara></listitem>
	</itemizedlist>

	<para>
	  Ein lokales Repository kann - gerade bei Einbindung des
	  unmaintained-Zweiges - viel Plattenplatz in Anspruch nehmen.
	</para>

	<section id="computers:Konfiguration_ueber_die_Univention_Management_Console">
	  <title>Konfiguration über &ucsUMC;</title>
	  <para>
		Im UMC-Modul <guimenu>Repository-Einstellungen</guimenu>
		kann der <guimenu>Repository-Server</guimenu> und die Verwendung der
		Maintained- und Unmaintained-Sektionen festgelegt werden.
	  </para>
	</section>

	<section id="computers:Konfiguration_ueber_Univention_Configuration_Registry">
	  <title>Konfiguration über Univention Configuration Registry</title>
	  <para>
		Der zu verwendende Repository-Server wird in die
		&ucsUCRV; <envar>repository/online/server</envar> eingetragen und ist bei einer
		Neuinstallation auf <uri>updates.software-univention.de</uri> voreingestellt.
	  </para>

	  <para>
		Das unmaintained-Repository kann durch Setzen der
		&ucsUCRV; <envar>repository/online/unmaintained</envar> auf <literal>yes</literal> integriert
		werden.
	  </para>
	</section>

	<section id="computers:Richtlinienbasierte_Konfiguration_des_Repository-Servers">
	  <title>Richtlinienbasierte Konfiguration des Repository-Servers</title>
	  <para>
		Der zu verwendende Repository-Server kann auch über die Richtlinie
		<guimenu>Repository-Server</guimenu> in der UMC-Rechnerverwaltung
		festgelegt werden. In dem Auswahlfeld werden UCS-Server-Systeme
		angezeigt, für die ein DNS-Eintrag hinterlegt ist
		(siehe auch <xref linkend="central:policies"/>).
	  </para>
	</section>

	<section id="software::createrepo">
	  <title>Einrichtung und Aktualisierung eines lokalen Repositorys</title>
	  <para>
		Paketinstallationen und Updates können entweder vom Univention-Update-Server oder von
		einem lokal gepflegten Repository durchgeführt werden. Ein lokales Repository ist
		sinnvoll wenn viele UCS-Systeme zu aktualisieren sind, da Updates in diesem Fall nur
		einmalig heruntergeladen werden müssen. Da Repositorys auch offline aktualisiert
		werden können, ermöglicht ein lokales Repository auch die Aktualisierung von
		UCS-Umgebungen ohne Internetanbindung.
	  </para>

	  <para>
		Es besteht auch die Möglichkeit lokale Repositorys zu synchronisieren, so dass
		beispielsweise in der Firmenzentrale ein Haupt-Repository gepflegt wird, das dann in
		lokale Repositorys der einzelnen Standorte synchronisiert wird. Um ein Repository
		einzurichten, muss der Befehl <command>univention-repository-create</command> als
		Benutzer <systemitem class="username">root</systemitem> aufgerufen werden. Der initiale Paketbestand wird
		von einer Installations-DVD eingelesen, mit dem Parameter <option>--iso</option>
		kann hier auch ein ISO-Image übergeben werden. UCS ist nur als 64 Bit-DVD
		verfügbar. Das Repository wird von <command>univention-repository-create</command>
		mit der Architektur des angegebenen Installationsmediums erzeugt. Wird eine Umgebung
		betrieben, in der sowohl 32-, als auch 64 Bit-Pakete bereitgestellt werden sollen,
		sind die folgenden Befehle auf dem Repository-Server nötig:

		<programlisting language="sh">
ucr set repository/online/architectures="i386 amd64"
univention-repository-update net
		</programlisting>
	  </para>

	  <para>
		Der Zugriff auf das Univention Online-Repository wird durch Verwendung von Secure APT
		über Signaturen kryptografisch gesichert. Für lokale Repositorys besteht diese
		Möglichkeit aktuell noch nicht, so dass beim Erstellen eines Repositorys ein Hinweis
		ausgegeben wird, wie Secure APT mit der &ucsUCRV; <envar>update/secure_apt</envar>
		deaktiviert werden kann. Diese Einstellung muss auf allen UCS-Systemen gesetzt werden,
		die auf das Repository zugreifen.
	  </para>

	  <para>
		Mit dem Tool <command>univention-repository-update</command> werden die Pakete im
		Repository aktualisiert. Es unterstützt zwei Modi:

	  </para>
	  <itemizedlist>
		<listitem> <simpara>
		  <command>univention-repository-update cdrom</command> Dabei wird das Repository über
		  eine Update-DVD oder ein ISO-Image aktualisiert.
		</simpara> </listitem>

		<listitem><simpara>
		  <command>univention-repository-update net</command> Bei dieser Variante wird das
		  Repository mit einem angegebenen anderen Repository-Server synchronisiert. Dieser ist
		  in der &ucsUCRV; <envar>repository/mirror/server</envar> definiert (typischerweise
		  <uri>updates.software-univention.de</uri>).
		</simpara></listitem>
	  </itemizedlist>

	  <para>
		Eine Übersicht über die möglichen Optionen kann mit folgendem Befehl aufgerufen werden:
	  </para>

	  <programlisting language="sh">
univention-repository-update -h
	  </programlisting>

	  <para>
		  Das Repository wird im Verzeichnis <filename class="directory">/var/lib/univention-repository/mirror/</filename> vorgehalten.
	  </para>

	  <para>
		Durch die &ucsUCRV; <envar>local/repository</envar> kann das lokale Repository
		aktiviert/deaktiviert werden.
	  </para>

	</section>
  </section>

  <section id="computers::softwaremanagement::installsoftware">
	<title>Installation weiterer Software</title>
	<para>
	  Die Erstauswahl der Softwarekomponenten eines UCS-Systems
	  erfolgt im Rahmen der Installation. Die Auswahl der
	  Softwarekomponenten erfolgt dabei funktionsbezogen, indem etwa die
	  Komponente <emphasis>Proxy-Server</emphasis> ausgewählt wird, die dann über ein
	  Meta-Paket die eigentlichen Software-Pakete nachzieht. Der
	  Administrator muss dazu die eigentlichen Paketnamen nicht kennen.
	  Für weitergehende Aufgaben können aber auch einzelne Pakete gezielt
	  installiert und entfernt werden.
	  Bei der Installation eines Pakets werden unter Umständen Pakete
	  mitinstalliert, die für die Funktion des angegebenen Pakets
	  erforderlich sind, die sogenannten Paketabhängigkeiten.
	  Alle Softwarekomponenten werden aus einem Repository geladen (siehe
	  <xref linkend="software::configrepo"/>).
	</para>

	<para>
	  Fremdsoftware, die nicht im Debian-Paketformat vorliegt, sollte in
	  die Verzeichnisse <filename class="directory">/opt/</filename> oder <filename class="directory">/usr/local/</filename> installiert
	  werden. UCS-Pakete nutzen diese Verzeichnisse nicht, so dass eine
	  saubere Trennung von UCS- und Fremdsoftware gewährleistet ist.
	</para>

	<para>
	  Um auf einem bereits installierten System nachträglich weitere Pakete
	  zu installieren, stehen mehrere Möglichkeiten zur Verfügung:
	</para>

	<section id="computers:softwareselection">
	  <title>Installation/Deinstallation von UCS-Komponenten im Univention App Center</title>
	  <para>
		Alle Softwarekomponenten, die im Univention Installer angeboten werden, können auch
		über das Univention App Center nachträglich installiert und entfernt werden. Dazu
		muss die Paket-Kategorie <guimenu>UCS-Komponenten</guimenu> ausgewählt
		werden. Weitere Hinweise zum Univention App Center finden sich in <xref linkend="software:appcenter"/>.
	  </para>

	  <figure id="appcenter-ucscomponents">
		<title>Auswahl von UCS-Komponenten im App Center</title>
		<graphic scalefit="1" width="100%" fileref="illustrations44/appcenter-ucs-de.png"/>
	  </figure>

	</section>

	<section
		id="computers:Installation_Deinstallation_von_einzelnen_Paketen_in_der_Univention_Management_Console">
	  <title>Installation/Deinstallation von einzelnen Paketen in &ucsUMC;</title>
	  <para>
		Mit dem &ucsUMC;-Modul <guimenu>Paket Verwaltung</guimenu> können einzelne Softwarepakete installiert
		und deinstalliert werden.
	  </para>

	  <figure id="software-umcinstall"><title>Installation des Pakets <package>univention-squid</package> in &ucsUMC;</title>
	  <graphic scalefit="1" width="100%" fileref="illustrations44/software_install_de1.png"/>
	  </figure>

	  <para>
		Auf der Startseite wird eine Suchmaske angezeigt in der die Paketkategorie und
		ein Suchfilter (Name oder Beschreibung) zur Auswahl
		stehen. Die Ergebnisliste besteht aus einer Tabelle mit den folgenden Spalten:
	  </para>

	  <itemizedlist>
		<listitem><simpara>Paketname</simpara></listitem>
		<listitem><simpara>Paketbeschreibung</simpara></listitem>
		<listitem><simpara>Paketstatus</simpara></listitem>
	  </itemizedlist>

	  <para>
		Durch einen Klick auf eine Zeile in der Ergebnisliste wird eine detaillierte
		Informationsseite zu dem Softwarepaket angezeigt, u.a. eine
		ausführliche Beschreibung und die Versionsnummer.
	  </para>

	  <para>
		Zusätzlich werden ein oder mehrere Buttons angezeigt:
		<guimenu>Installieren</guimenu> wird angezeigt, falls das Softwarepaket noch nicht
		installiert ist, <guimenu>Deinstallieren</guimenu>, falls das Paket installiert
		ist und <guimenu>Aktualisieren</guimenu> falls das Softwarepaket bereits
		installiert, aber nicht aktuell ist. Durch <guimenu>Schließen</guimenu> kann zu
		der vorherigen Suchabfrage zurückgekehrt werden.
	  </para>
	</section>

	<section id="computers:Installation_Deinstallation_von_einzelnen_Paketen_auf_der_Kommandozeile">
	  <title>Installation/Deinstallation von einzelnen Paketen auf der Kommandozeile</title>
	  <para>
		Die folgenden Schritte müssen mit <systemitem class="username">root</systemitem>-Rechten durchgeführt werden.
	  </para>

	  <para>
		Die Installation einzelner Pakete erfolgt mit dem Kommando
	  </para>

	  <programlisting language="sh">
univention-install PAKETNAME
	  </programlisting>

	  <para>
		Pakete können mit dem folgenden Befehl entfernt werden:
	  </para>

	  <programlisting language="sh">
univention-remove PAKETNAME
	  </programlisting>

	  <para>
		Wenn der Name eines Pakets nicht bekannt ist, kann mit dem Kommando
		<command>apt-cache search</command> nach Paketen gesucht werden. Als Aufrufparameter
		können Teile des Namens oder Wörter, die in der Beschreibung eines Paketes
		vorkommen angegeben werden, z.B.
	  </para>

	  <programlisting language="sh">
apt-cache search fax
	  </programlisting>
	</section>

	<section id="computers::softwaremanagement::packagelists"><title>Richtlinienbasierte Installation/Deinstallation von einzelnen Paketen über Paketlisten</title>
	<para>
	  Mit Paketlisten kann richtlinienbasiert Software installiert und
	  entfernt werden. Dadurch lassen sich auch große Stückzahlen an
	  Rechnersystemen zentral mit neuer Software versehen.
	</para>

	<para>
	  Jede Systemrolle verfügt über eine eigenen Paket-Richtlinien-Typ.
	</para>

	<para>
	  Paketrichtlinien werden im UMC-Modul <emphasis>Richtlinien</emphasis>
	  mit dem Objekttyp <guimenu>Richtlinie: Pakete + Systemrolle</guimenu>
	  verwaltet.
	</para>

	<table>
	  <title>Karteikarte '[Pakete ...]'</title>
	  <tgroup cols="2">
		<colspec colnum="1" colname="col1" colwidth="1*"/>
		<colspec colnum="2" colname="col2" colwidth="2*"/>
		<thead>
		  <row>
			<entry>Attribut</entry>
			<entry>Beschreibung</entry>
		  </row>
		</thead>
		<tbody>
		  <row>
			<entry>Name</entry>
			<entry>
			  Ein eindeutiger Name für diese Paketliste, z.B. <emphasis>Standort-Server</emphasis>.
			</entry>
		  </row>
		  <row>
			<entry>[...] Pakete Installationsliste</entry>
			<entry>
			  Eine Liste zu installierender Pakete.
			</entry>
		  </row>
		  <row>
			<entry>[...] Pakete Deinstallationsliste</entry>
			<entry>
			  Eine Liste zu entfernender Pakete.
			</entry>
		  </row>
		</tbody>
	  </tgroup>
	</table>
	<para>
	  Die in einer Paketliste definierten Softwarepakete werden zu dem in
	  der <guimenu>Paketpflege</guimenu>-Richtlinie definierten Zeitpunkt (zur
	  Konfiguration siehe <xref linkend="computers::softwaremanagement::maintenancepolicy"/>) installiert, bzw. deinstalliert.
	</para>
	<para>
	  Die in den Pakete-Richtlinien zuordbaren Softwarepakete werden ebenfalls im
	  LDAP registriert.
	  <!-- Dies ist im Univention Wiki unter WIKIREF-24368 dokumentiert. -->
	</para>
	</section>
  </section>

  <section id="computers::softwaremanagement::maintenancepolicy">
	<title>Festlegung eines Aktualisierungs-Zeitpunkts mit der Paketpflege-Richtlinie</title>
	<para>
	  Mit einer <guimenu>Paketpflege</guimenu>-Richtlinie
	  (siehe auch <xref linkend="central:policies"/>) in den
	  UMC-Modulen zur Rechner und Domänenverwaltung kann ein Zeitpunkt
	  vorgegeben werden, an dem die folgenden Schritte durchgeführt werden:
	</para>
	<itemizedlist>
	  <listitem>
		<simpara>
		  Prüfung auf verfügbare und zu installierende Release-Updates
		  (siehe <xref linkend="computers::softwaremanagement::releasepolicy"/>)
		  und ggf. Installation
		</simpara>
	  </listitem>
	  <listitem>
		<simpara>
		  Installation/Deinstallation von Paketlisten (siehe
		  <xref linkend="computers::softwaremanagement::packagelists"/>)
		</simpara>
	  </listitem>
	  <listitem>
		<simpara>
		  Installation verfügbarer Errata-Updates
		</simpara>
	  </listitem>
	</itemizedlist>

	<para>
	  Alternativ können die Aktualisierungen auch beim Systemstart oder
	  beim Herunterfahren des Systems erfolgen.
	</para>

	<table>
	  <title>Karteikarte '[Paketpflege]'</title>
	  <tgroup cols="2">
		<colspec colnum="1" colname="col1" colwidth="1*"/>
		<colspec colnum="2" colname="col2" colwidth="2*"/>
		<thead>
		  <row>
			<entry>Attribut</entry>
			<entry>Beschreibung</entry>
		  </row>
		</thead>
		<tbody>
		  <row>
			<entry>Paketpflege durchführen nach Hochfahren des Systems</entry>
			<entry>
			  Falls diese Option aktiviert ist, werden die Aktualisierungsschritte
			  während des Startvorgangs des Rechners durchgeführt.
			</entry>
		  </row>
		  <row>
			<entry>Paketpflege durchführen vor Herunterfahren des Systems</entry>
			<entry>
			  Falls diese Option aktiviert ist, werden die Aktualisierungsschritte
			  beim Herunterfahren des Rechners durchgeführt.
			</entry>
		  </row>
		  <row>
			<entry>Cron Einstellung benutzen</entry>
			<entry>
			  Wird dieses Feld aktiviert, kann über die Felder <emphasis>Monat</emphasis>,
			  <emphasis>Wochentag</emphasis>, <emphasis>Tag</emphasis>, <emphasis>Stunde</emphasis> und <emphasis>Minute</emphasis> ein
			  genauer Zeitpunkt angegeben werden, an dem die Aktualisierungsschritte
			  durchgeführt werden sollen.
			</entry>
		  </row>
		  <row>
			<entry>Nach Paketpflege neu starten</entry>
			<entry>
			  Diese Option ermöglicht es, nach Release-Aktualisierungen
			  optional einen automatischen Neustart des Systems durchzuführen, entweder
			  direkt oder nach dem angegebenen Zeitintervall in Stunden.
			</entry>
		  </row>
		</tbody>
	  </tgroup>
	</table>
  </section>

  <section id="computers::softwaremonitor">
	<title>Zentrale Überwachung von Softwareinstallationsständen mit dem Software-Monitor</title>
	<para>
	  Der Software-Monitor ist eine Datenbank, in der Informationen über die auf UCS-Systemen
	  installierten Softwarepakete aufgezeichnet werden. Durch diese Datenbank kann sich ein
	  Administrator einen Überblick verschaffen, welche Release- und Paketversionen auf den
	  Systemen der Domäne installiert sind und diese Informationen bei der schrittweisen
	  Aktualisierung einer UCS-Domäne nutzen und Installations-Probleme erkennen.
	</para>

	<para>
	  Der Software-Monitor kann mit der Applikation
	  <emphasis>Software-Installationsmonitor</emphasis> aus dem Univention App Center installiert
	  werden. Alternativ kann das Softwarepaket <package>univention-pkgdb</package> installiert
	  werden. Weitere Informationen finden sich in <xref linkend="computers::softwaremanagement::installsoftware"/>.
	</para>

	<para>
	  UCS-Systeme aktualisieren ihre Einträge bei der Installation, Entfernung und
	  Aktualisierung von Software automatisch. Das System, auf dem der Software-Monitor
	  betrieben wird, wird dabei durch den DNS-Service-Record <command>_pkgdb._tcp</command>
	  lokalisiert.
	</para>

	<para>
	  Die webbasierte Abfrageschnittstelle des Software-Monitors integriert sich in die
	  &ucsUMC; und kann über das Modul <guimenu>Software-Monitor</guimenu> erreicht
	  werden. Folgende Funktionen stehen zur Verfügung:
	</para>

	<itemizedlist>
	  <listitem><simpara>
		<emphasis>Systeme</emphasis> erlaubt die Suche nach den installierten Versionsständen
		von UCS-Systemen. Es kann nach Systemnamen, UCS-Versionen und Systemrollen gesucht werden.
	  </simpara></listitem>

	  <listitem> <para>
		<emphasis>Pakete</emphasis> ermöglicht die Suche in den von der Paketstatusdatenbank
		erfassten Installationsdaten. Neben der Suche nach <emphasis>Paketnamen</emphasis>
		gibt es auch die folgenden Suchmöglichkeiten zu den Installationszuständen von Paketen:
	  </para>

	  <itemizedlist>
		<listitem> <simpara>
		  Der <emphasis>Selektionsstatus</emphasis> beeinflusst das Verhalten bei der
		  Aktualisierung eines Pakets. Durch <literal>Install</literal> wird ein Paket zur
		  Installation ausgewählt. Ist ein Paket auf <literal>Hold</literal> konfiguriert,
		  so wird es von weiterer Aktualisierung ausgenommen. Es existieren zwei Möglichkeiten
		  ein Paket zu deinstallieren: Ein mit <literal>DeInstall</literal> entferntes Paket
		  hält lokal erzeugte Konfigurations-Daten weiterhin vor, während ein mit
		  <literal>Purge</literal> entferntes Paket komplett gelöscht wird.
		</simpara></listitem>

		<listitem><simpara>
		  Der <emphasis>Installationsstatus</emphasis> beschreibt den Status eines
		  installierten Pakets im Hinblick auf kommende Aktualisierungen. Der Normalfall ist
		  <literal>Ok</literal>, was dazu führt, dass ein Paket bei Vorhandensein einer
		  aktuelleren Version aktualisiert würde. Ist ein Paket auf <literal>Hold</literal>
		  konfiguriert, so wird es von der Aktualisierung ausgenommen.
		</simpara> </listitem>

		<listitem><simpara>
		  Der <emphasis>Paketstatus</emphasis> beschreibt den Zustand eines eingerichteten
		  Pakets. Der Normalfall ist <literal>Installed</literal> für installierte und
		  <literal>ConfigFiles</literal> für entfernte Pakete, alle übrigen Zustände
		  entstehen, wenn die Installation des Pakets in verschiedenen Phasen abgebrochen wurde.
		</simpara></listitem>

	  </itemizedlist>
	  </listitem>

	</itemizedlist>
	<figure id="software-monitor"><title>Suche nach Paketen im Software-Monitor</title>
	<graphic scalefit="1" width="100%" fileref="illustrations44/software_softwaremonitor_de.png"/>
	</figure>

	<para>
	  Wenn verhindert werden soll, dass UCS-Systeme Installations-Vorgänge im Software-Monitor
	  aufzeichnen (etwa weil keine Netzwerkverbindung zur Datenbank besteht), kann dies durch
	  Setzen der &ucsUCRV; <envar>pkgdb/scan</envar> auf <literal>no</literal> abgeschaltet
	  werden. Wenn die Aufzeichnungen danach wieder aktiviert werden, muss das Kommando
	  <command>univention-pkgdb-scan</command> ausgeführt werden, damit die in der
	  Zwischenzeit installierten Paketversionen in die Datenbank übernommen werden.
	</para>

	<para>
	  Mit dem folgenden Befehl kann der Programmbestand eines Systems wieder aus der Datenbank entfernt werden:
	</para>
	<programlisting language="sh">
univention-pkgdb-scan --remove-system RECHNERNAME
	</programlisting>
  </section>
</chapter>
<!-- vim:set ts=2 sw=2 tw=100 noet ft=docbk:-->
