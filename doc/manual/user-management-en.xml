<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE chapter [
	<!ENTITY % extensions SYSTEM "../stylesheets/macros.ent" >
	<!ENTITY % DocBookDTD PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
	"http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd">
	<!ENTITY % entities SYSTEM "../stylesheets/macros-en.ent" >
	%extensions;
	%DocBookDTD;
	%entities;
]>
<chapter id="users:general">
    <title>User management</title>
    <para>
        UCS integrates central identity management. All user information are
        managed centrally in UCS via &ucsUMC; and stored in the LDAP directory
        service.
    </para>
    <para>
        All the services integrated in the domain access the central account
        information, i.e., the same username and password are used for the
        user login to a Windows client as for the login on the IMAP server.
    </para>
    <para>
        The domain-wide management of user data reduces the administrative
        efforts as changes do not need to be subsequently configured on
		different individual systems. Moreover, this also avoids subsequent errors
		arising from inconsistencies between the individual datasets.
    </para>
    <para>
        There are three different types of users in UCS:
        <orderedlist>
             <listitem><simpara>
                  <emphasis>Normal user account</emphasis>:
                  Normal user accounts have all available properties. These users
                  can log on to UCS or Windows systems and, depending on the configuration, also
                  to the installed Apps. The users can be administered via the UMC module
                  <guimenu>Users</guimenu> (see <xref linkend="users::management"/>).
             </simpara></listitem>

             <listitem><simpara>
                  <emphasis>Address book entries</emphasis>:
                  Address book entries can be used to maintain internal or external contact information.
                  These contacts can not log on to UCS or Windows systems. Address book entries can be
                  managed via the UMC module <guimenu>Contacts</guimenu>.
             </simpara></listitem>

             <listitem><simpara>
                  <emphasis>Simple authentication account</emphasis>:
                  With a simple authentication account, a user object is created, which has only a user
                  name and a password. With this account, only authentication against the LDAP directory
                  service is possible, but no logon to UCS or Windows systems. Simple authentication accounts
                  can be accessed via the UMC module <guimenu>LDAP directory</guimenu>
                  (see <xref linkend="central:navigation"/>).
             </simpara></listitem>
        </orderedlist>
    </para>
    <section id="users::management">
        <title>User management with Univention Management Console</title>
        <para>
			Users are managed in the UMC module <emphasis>Users</emphasis>
			(see <xref linkend="central:user-interface"/>).
        </para>
		<figure id="user-create">
			<title>Creating a user in UMC</title>
			<graphic scalefit="1" width="65%" align="center" fileref="illustrations44/users_user_en.png"/>
		</figure>
		<para>
			With <guimenu>Next</guimenu> on <xref linkend="user-create"/> the second page <xref linkend="user-password"/> is shown, where the initial password can be set.
		</para>
		<figure id="user-password">
			<title>Password setting for a new user</title>
			<graphic scalefit="1" width="65%" align="center" fileref="illustrations44/users_password_en.png"/>
		</figure>
		<para>
			As an alternative the user may set the initial password himself if the Self Service app is installed.
			For this to work an external e-mail address must be given, which is registered at the contact e-mail address.
			The user will then get an e-mail to that address containing a web address and a token, which can be used to set the password and unlock the account.
			For this also see <xref linkend="user-management:password-changes-by-users:self-service"/>.
		</para>
		<figure id="user-password-new">
			<title>Initial user password</title>
			<graphic scalefit="1" width="90%" align="center" fileref="illustrations44/users_self-service_en.png"/>
		</figure>
        <para>
		  In the default setting, a simplified wizard for creating a user is shown, which only
		  requests the most important settings. All attributes can be shown by clicking on
		  <guimenu>Advanced</guimenu>. The simplified wizard can be deactivated by setting the
		  &ucsUCRV; <envar>directory/manager/web/modules/users/user/wizard/disabled</envar> to
		  <literal>true</literal>.
		</para>
		<figure id="user-create-advanced">
			<title>Advanced user settings</title>
			<graphic scalefit="1" width="90%" align="center" fileref="illustrations44/users_user_advanced_en.png"/>
		</figure>
        <table>
            <title>'General' tab</title>
            <tgroup cols="2">
                <colspec colnum="1" colname="col1" colwidth="1*"/>
                <colspec colnum="2" colname="col2" colwidth="2*"/>
                <thead>
                    <row>
                        <entry>Attribute</entry>
                        <entry>Description</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>User name</entry>
                        <entry>
                            <para>
                                This is the name, by which the user logs into the system. The name has to
                                begin with a letter which has to be followed by: letters a-z in lower case,
                                numerals 0-9, dots, hyphens, or underlines. User names may not contain blank spaces.
                            </para>
                            <para>
                                In order to ensure compatibility to non-UCS systems the creation of users
                                which are only distinguished from each other by upper and lower case letters
                                is prevented. Thus, if the user name <emphasis>smith</emphasis> already exists, then the user
                                name <emphasis>Smith</emphasis> cannot be created.
                            </para>
                            <para>
							  In the default setting, it is not possible to create a user with the same name as an
							  existing group. If the &ucsUCRV; <envar>directory/manager/user_group/uniqueness</envar>
							  is set to <literal>false</literal>, this check is removed.
							</para>
                        </entry>
                    </row>
                    <row>
                        <entry>Description</entry>
                        <entry>
                            Arbitrary descriptions for the user can be entered here.
                        </entry>
                    </row>
                    <row>
                        <entry>Password</entry>
                        <entry>
                            The user's password has to be entered here.
                        </entry>
                    </row>
                    <row>
                        <entry>Password (retype)</entry>
                        <entry>
                            In order to avoid spelling errors, the user's password has to be entered for a
                                second time.
                        </entry>
                    </row>
                    <row>
                        <entry>Override password history</entry>
                        <entry>
                            By checking this box, the password history is overridden for this user and for
                            this password change. This means, with this change the user can be assigned a
                            password which is already in use. Further details on user password management
                            can be found in <xref linkend="users:passwords"/>.
                        </entry>
                    </row>
                    <row>
                        <entry>Override password check</entry>
                        <entry>
                            By checking this box, the requirements for the length of the password and for password quality checks are
                            overridden for this user and for this password change. This means, the user
                            can e.g. be assigned a shorter password than would be possible according to the
                            defined minimum length. Further details on the password policies for users can
                            be found in <xref linkend="users:passwords"/>.
                        </entry>
                    </row>
                    <row>
                        <entry>Primary e-mail address</entry>
                        <entry>
                            The e-mail address of the user is declared here, see
                            <xref linkend="mail::management::users"/>.
                        </entry>
                    </row>
                    <row>
                        <entry>Title</entry>
                        <entry>
                            The title of the user is to be entered here.
                        </entry>
                    </row>
                    <row>
                        <entry>First name</entry>
                        <entry>
                            The first name of the user is to be entered here.
                        </entry>
                    </row>
                    <row>
                        <entry>Last name</entry>
                        <entry>
                            The last name of the user is to be entered here.
                        </entry>
                    </row>
                    <row>
                        <entry>Display name</entry>
                        <entry>
                            The display name is automatically composed of the first and
                            surnames. It generally does not need to be changed. The screen name is
                            used for the synchronization with Active Directory and Samba 4 among
                            other things.
                        </entry>
                    </row>
                    <row>
                        <entry>Organization</entry>
                        <entry>
                            The organization is to be entered here.
                        </entry>
                    </row>
                    <row>
                        <entry>Birthday</entry>
                        <entry>
                            This field is used to save a user's birthday.
                        </entry>
                    </row>
                    <row>
                        <entry>Picture of the user (JPEG format)</entry>
                        <entry>
                            This mask can be used to save a picture of the user in LDAP in JPEG format. In
                            the default settings the file size is limited to 512 kilobytes.
                        </entry>
                    </row>
                    <row>
                        <entry>Employee number</entry>
                        <entry>
                            Numbers for staff members can be entered in this field.
                        </entry>
                    </row>
                    <row>
                        <entry>Employee type</entry>
                        <entry>
                            The category of the staff member can be entered here.
                        </entry>
                    </row>
                    <row>
                        <entry>Superior</entry>
                        <entry>
                            The superior of the user can be selected here.
                        </entry>
                    </row>
                </tbody>
            </tgroup>
        </table>
        <table>
            <title>'Groups' tab</title>
            <tgroup cols="2">
                <colspec colnum="1" colname="col1" colwidth="1*"/>
                <colspec colnum="2" colname="col2" colwidth="2*"/>
                <thead>
                    <row>
                        <entry>Attribute</entry>
                        <entry>Description</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>Primary group</entry>
                        <entry>
                            This select list can be used for specifying the user's primary
                            group. All the groups registered in the domain are open for selection. By
                            default, the group <systemitem class="groupname">Domain Users</systemitem> is preset.
                        </entry>
                    </row>
                    <row>
                        <entry>Groups</entry>
                        <entry>
                            Here it is possible to set further group memberships for the user in
                            addition to the primary group.
                        </entry>
                    </row>
                </tbody>
            </tgroup>
        </table>
        <table>
            <title>'Account' tab</title>
            <tgroup cols="2">
                <colspec colnum="1" colname="col1" colwidth="1*"/>
                <colspec colnum="2" colname="col2" colwidth="2*"/>
                <thead>
                    <row>
                        <entry>Attribute</entry>
                        <entry>Description</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>Account is deactivated</entry>
                        <entry>
                            <para>
                                The <guimenu>Account is deactivated</guimenu> checkbox can be used to
				deactivate the user account. If this is activated, the user cannot log
				into the system. This affects all authentication methods.
                                This is typically used when a user leaves the company. In a heterogeneous
                                environment, an account deactivation might also be caused by external tools.
                            </para>
						</entry>
                    </row>
                    <row>
                        <entry>Account expiry date</entry>
                        <entry>
                            <para>
                                A date is specified in this input field on which the account will
                                automatically be locked. This is practical for user accounts that
                                only need to be active for a certain period of time, e.g., for
                                interns.
                            </para>
                            <para>
                                If the date is deleted or replaced by a different, future date, the user will
                                regain the right to log in.
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>Change password on next login</entry>
                        <entry>
                            If this checkbox is ticked, then the user has to change his password during
                            the next login procedure.
                        </entry>
                    </row>
                    <row>
                        <entry>Password expiry date</entry>
                        <entry>
                            <para>
                                If the password is subject to an expiry date, then this date is displayed in
                                this entry field. This entry field cannot be edited directly, see
                                <xref linkend="users:passwords"/>.
                            </para>
                            <para>
                                If a password expiry interval is defined, the password expiry date is
                                automatically adjusted when passwords are changed.
                            </para>
                            <para>
                                If no <guimenu>Expiry interval</guimenu> is declared, the old expiry date will be
                                deleted and no new date will be set.
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>Reset lockout</entry>
                        <entry>
                            <para>
                                If the account has automatically been locked temporarily for security reasons,
                                usually because the user has entered the password incorrectly too often,
                                this checkbox can be used to unlock the account again manually before the lockout
                                is lifted automatically when the lockout duration has passed.
                                This temporary account lockout can happen if a corresponding domain wide policy
                                setting has been defined by an administrator.
                                There are three different mechanisms that may trigger lockout if configured properly:
                                <itemizedlist>
                                    <listitem>
                                        <simpara>
                                            Failed PAM authentication attempts to an UCS server (see <xref linkend="users:faillog"/>).
                                        </simpara>
                                        <simpara>
                                            Failed LDAP authentication attempts (if the <filename>ppolicy</filename> overlay has been activated and configured).
                                        </simpara>
                                        <simpara>
                                            Failed Samba/AD authentication attempts (if the Samba domain <property>passwordsettings</property> have been configured).
                                        </simpara>
                                    </listitem>
                                </itemizedlist>
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>Lockout ends</entry>
                        <entry>
                            <para>
                                If the account has automatically been locked temporarily for security reasons,
                                usually because the user has entered the password incorrectly too often,
                                this field shows the time when the account automatically gets unlocked.
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>Windows home drive</entry>
                        <entry>
                            If the Windows home directory for this user is to show up on a different
                            Windows drive than that specified by the Samba configuration, then the
                            corresponding drive letter can be entered here, e.g. <filename class="partition">M:</filename>.
                        </entry>
                    </row>
                    <row>
                        <entry>Windows home path</entry>
                        <entry>
                            The path of the directory which is to be the user's Windows home directory, is
                            to be entered here, e.g. <filename class="directory">\\ucs-file-server\smith</filename>
                        </entry>
                    </row>
                    <row>
                        <entry>Windows logon script</entry>
                        <entry>
                            The user-specific logon script relative to the NETLOGON share is entered here, e.g.
                            <filename>user.bat</filename>.
                        </entry>
                    </row>
                    <row>
                        <entry>Windows profile directory</entry>
                        <entry>
                            The profile directory for the user can be entered here, e.g.
                            <filename class="directory">\\ucs-file-server\user\profile</filename>.
                        </entry>
                    </row>
                    <row>
                        <entry>Relative ID</entry>
                        <entry>
                            The relative ID (RID) is the local part of the SID. If a user is to be
                            assigned a certain RID, the ID in question can be entered in this field. If no
                            RID is assigned, the next available RID will automatically be used. The RID
                            cannot be subsequently changed. Integers from 1000 upwards are permitted. RIDs
                            below 1000 are reserved to standard groups and other special objects.
                        </entry>
                    </row>
                    <row>
                        <entry>Samba privileges</entry>
                        <entry>
                            This selection mask can be used to assign a user selected Windows
                            systems rights, for example the permission to join a system to the
                            domain.
                        </entry>
                    </row>
                    <row>
                        <entry>Permitted times for Windows logins</entry>
                        <entry>
                            <para>
                                This input field contains time periods for which this user can log on
                                to Windows computers.
                            </para>
                            <para>
                                If no entry is made in this field, the user can log in at any time of day.
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>Allow the authentication only on these Microsoft Windows hosts</entry>
                        <entry>
                            This setting specifies the clients where the user may log in. If no settings
                            are made, the user can log into any client.
                        </entry>
                    </row>
                    <row>
                        <entry>UNIX home directory</entry>
                        <entry>
                            The path of the user's home directory.
                        </entry>
                    </row>
                    <row>
                        <entry>Login shell</entry>
                        <entry>
                            The user's login shell is to be entered in this field. This program is started
                            if the user performs a text-based login. By default, <filename>/bin/bash</filename> is preset.
                        </entry>
                    </row>
                    <row>
                        <entry>User ID</entry>
                        <entry>
                            <para>
                                If the user is to be assigned a certain user ID, the ID in question
                                can be entered in this field. If no value is specified, a free user ID
                                is assigned automatically.
                            </para>
                            <para>
                                The user ID can only
                                be declared when adding the user. When the user data are subsequently edited,
                                the user ID will be represented in gray and barred from change.
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>Group ID of the primary group</entry>
                        <entry>
                            The group ID of the user's primary group is shown here. The primary
                            group can be changed in the <guimenu>General</guimenu> tab.
                        </entry>
                    </row>
                    <row>
                        <entry>Home share</entry>
                        <entry>
                            If a share is selected here, the home directory is stored on the
                            specified server. If no selection is made, the user data are saved on
                            the respective login system.
                        </entry>
                    </row>
                    <row>
                        <entry>Home share path</entry>
                        <entry>
                            The path of the home directory relative to the <guimenu>Home share</guimenu> is
                            declared here. The username is already preset as a default value when creating a user.
                        </entry>
                    </row>
                </tbody>
            </tgroup>
        </table>
        <table>
            <title>'Contact' tab</title>
            <tgroup cols="2">
                <colspec colnum="1" colname="col1" colwidth="1*"/>
                <colspec colnum="2" colname="col2" colwidth="2*"/>
                <thead>
                    <row>
                        <entry>Attribute</entry>
                        <entry>Description</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry lang="">E-mail address(es)</entry>
                        <entry>
                            <para>
                                Additional e-mail addresses can be saved here. These are not evaluated
                                by the mail server.
                            </para>
                            <para>
                                The values of this attribute are stored in the LDAP attribute <property>mail</property>.
                                Most address books applications using an LDAP search function will search for
                                an e-mail address by this attribute.
                            </para>
                        </entry>
                    </row>
                    <row>
                        <entry>Telephone number(s)</entry>
                        <entry>
                            This field contains the user's business phone number.
                        </entry>
                    </row>
                    <row>
                        <entry>Room number</entry>
                        <entry>
                            The room number of the user.
                        </entry>
                    </row>
                    <row>
                        <entry>Department number</entry>
                        <entry>
                            The department number of the user can be entered here.
                        </entry>
                    </row>
                    <row>
                        <entry>Street</entry>
                        <entry>
                            The street and house number of the user's business address can be entered here.
                        </entry>
                    </row>
                    <row>
                        <entry>Postal code</entry>
                        <entry>
                            This field contains the post code of the user's business address.
                        </entry>
                    </row>
                    <row>
                        <entry>City</entry>
                        <entry>
                            This field contains the city of the user's business address.
                        </entry>
                    </row>
                    <row>
                        <entry>Private telephone number(s)</entry>
                        <entry>
                            The private fixed network phone number can be entered here.
                        </entry>
                    </row>
                    <row>
                        <entry>Mobile telephone number(s)</entry>
                        <entry>
                            The user's mobile numbers can be entered here.
                        </entry>
                    </row>
                    <row>
                        <entry>Pager telephone number(s)</entry>
                        <entry>
                            Pager numbers can be entered here.
                        </entry>
                    </row>
                    <row>
                        <entry>Private postal address</entry>
                        <entry>
                            One or more of the user's private postal addresses can be entered in this
                            field.
                        </entry>
                    </row>
                </tbody>
            </tgroup>
        </table>
        <table>
            <title>'Mail' tab</title>
            <tgroup cols="1">
                <colspec colnum="1" colname="col1" colwidth="1*"/>
                <tbody>
                    <row>
                        <entry>
                            <para>
                                This tab is displayed in the advanced settings.
                            </para>
                            <para>
                                The settings are described in <xref linkend="mail::management::users"/>.
                            </para>
                        </entry>
                    </row>
                </tbody>
            </tgroup>
        </table>
        <table>
            <title>'(Options)' tab</title>
            <!--para>
                This tab makes it possible to select individual LDAP object classes for the
                user.
            </para-->
            <tgroup cols="2">
                <colspec colnum="1" colname="col1" colwidth="1*"/>
                <colspec colnum="2" colname="col2" colwidth="2*"/>
                <thead>
                    <row>
                        <entry>Attribute</entry>
                        <entry>Description</entry>
                    </row>
                </thead>
                <tbody>
                    <row>
                        <entry>Public key infrastructure account</entry>
                        <entry>
                            If this checkbox is not ticked, the user will not be assigned the object class
                            <classname>pkiUser</classname>.
                        </entry>
                    </row>
                </tbody>
            </tgroup>
        </table>
    </section>

    <section id="users:app-activation">
        <title>User activation for apps</title>
        <para>
            Many apps from the App Center are compatible with the central
            identity management in UCS. This allows system administrators to
            activate the users for apps. In some cases, app specific settings
            for the user can be made. This depends on the app and how it uses
            the identity management.
        </para>
        <figure id="user-app-activation">
            <title>User activation for installed apps</title>
            <graphic scalefit="1" width="100%" align="center" fileref="illustrations44/user_activation_en.png" />
        </figure>
        <para>
            Once an app with user activation is installed in the UCS
            environment, it will appear with the logo in the
            <guimenu>Apps</guimenu> tab of the user in the UMC module
            <emphasis>users</emphasis>. With a tick in the checkbox the user is
            activated for the app. If the app offers specific settings another
            tab with the name of the app will appear to set these parameters.
            The app activation and the parameters are stored at the user object
            in the LDAP directory service.
        </para>
        <para>
            To withdraw a user activation for an app, it is sufficient to
            deselect the checkbox.
        </para>
        <para>
            When the app is uninstalled, the checkbox of the user activation
            for the app is removed from the <guimenu>Apps</guimenu> tab of the
            user in the UMC module.
        </para>
    </section>

    <section id="users:passwords">
        <title>User password management</title>
        <para>
            Passwords which are difficult to guess and regular password changes
            are an essential element of the system security of a UCS domain. The
            following properties can be configured for users using a
            <emphasis>password</emphasis> policy.

			If Samba is used, the settings of the Samba domain object
			(see <xref linkend="users:password:samba"/>) apply for logins to Window clients.
			The settings of the Samba domain object and the policy should be set identically,
			otherwise different password requirements will apply for logins to Windows and UCS systems.
		</para>

        <para>
		  The password is saved in different attributes for every user saved in the management
		  system:
		</para>
		  <itemizedlist>
			<listitem><simpara>The <property>krb5Key</property> attribute stores the Kerberos
			password.</simpara></listitem>
			<listitem><simpara>The <property>userPassword</property> attribute stores the Unix password
			(In other Linux distributions present in <filename>/etc/shadow</filename>).</simpara></listitem>
			<listitem><simpara>The <property>sambaNTPassword</property> attribute stores the NT
			password hash used by Samba.</simpara></listitem>
		  </itemizedlist>
        <para>
		  Password changes are always initiated via Kerberos in the UCS PAM configuration.
		</para>

            <figure id="password-policy">
                <title>Configuring a password policy</title>
                <graphic scalefit="1" width="100%" fileref="illustrations44/users_policy_password_en.png"/>
            </figure>
            <itemizedlist>
			  <listitem>
				<para>
				  The <emphasis>history length</emphasis> saves the last password hashes. These
				  passwords can then not be used by the user as a new password when setting a new
				  password. With a password history length of five, for example, five new passwords
				  must be set before a password can be reused. If no password history check should be
				  performed, the value must be set to 0.
				</para>

				<para>
				  The passwords are not stored retroactively. Example: If ten passwords were stored,
				  and the value is reduced to three, the oldest seven passwords will be deleted
				  during the next password change. If then the value is increased again, the number
				  of stored passwords initially remains at three, and is only increased by each
				  password change.
				</para>
			  </listitem>

			  <listitem>
				<simpara>
				  The <emphasis>password length</emphasis> is the minimum length in characters that
				  a user password must comply with. If no value is entered here, the minimum size is
				  eight characters. The default value of eight characters for password length is
				  fixed, so it always applies if no policy is set and the <guimenu>Override password
				  check</guimenu> checkbox is not ticked. This means it even applies if the
				  <emphasis>default-settings</emphasis> password policy has been deleted. If no
				  password length check should be performed, the value must be set to 0.
				</simpara>
			  </listitem>

                <listitem>
					<simpara>
                    A <emphasis>password expiry interval</emphasis> demands regular password
                    changes. A password change is demanded during logons to &ucsUMC;, to Kerberos,
                    on Windows clients and on UCS systems following expiry of the period
                    in days. The remaining validity of the password is displayed in the
                    user management under <guimenu>Password expiry date</guimenu> in the
                    <guimenu>Account</guimenu> tab.
					If this input field is left blank, no password expiry interval is applied.
					</simpara>
                </listitem>
                <listitem>
                    <para>
                        If the option <emphasis>Password quality check</emphasis> is activated,
                        additional checks - including dictionary checks - are performed for
                        password changes in Samba, &ucsUMC; and Kerberos.
                    </para>
                    <para>
                        The configuration is done via &ucsUCR; and should occur on all login
                        servers. The following checks can be enforced:
                    </para>
                        <itemizedlist>
                            <listitem>
								<simpara>
                                Minimum number of digits in the new password
                                (<envar>password/quality/credit/digits</envar>).
								</simpara>
                            </listitem>
                            <listitem>
								<simpara>
                                Minimum number of uppercase letters in the new password
                                (<envar>password/quality/credit/upper</envar>).
								</simpara>
                            </listitem>
                            <listitem>
								<simpara>
                                Minimum number of lowercase letters in the new password
                                (<envar>password/quality/credit/lower</envar>).
								</simpara>
                            </listitem>
                            <listitem>
								<simpara>
                                Minimum number of characters in the new password which are
                                neither letters nor digits (<envar>password/quality/credit/other</envar>).
								</simpara>
                            </listitem>
                            <listitem>
								<simpara>
                                Individual characters/digits can be excluded
                                (<envar>password/quality/forbidden/chars</envar>).
								</simpara>
                            </listitem>
                            <listitem>
								<simpara>
                                Individual characters/figures can be made compulsory
                                (<envar>password/quality/required/chars</envar>).
								</simpara>
                            </listitem>
                        </itemizedlist>
                </listitem>
            </itemizedlist>
    </section>

    <section id="users:password:samba">
	  <title>Password settings for Windows clients when using Samba</title>

	  <para>
		With the Samba domain object, one can set the password
		requirements for logins to Windows clients in a Samba domain.
	  </para>

	  <para>
		The Samba domain object is managed via the
		UMC module <emphasis>LDAP directory</emphasis>. It can
		be found in the <uri>samba</uri> container below
		the LDAP base and carries the domain's NetBIOS name.
	  </para>

	  <para>
		The settings of the Samba domain object and the policy (see
		<xref linkend="users:passwords"/>) should be set identically,
		otherwise different password requirements will apply for
		logins to Windows and UCS systems.
	  </para>

		<table>
		  <title>'General' tab</title>
		  <tgroup cols="2">
			<colspec colnum="1" colname="col1" colwidth="1*"/>
			<colspec colnum="2" colname="col2" colwidth="2*"/>
			<thead>
			  <row>
				<entry>Attribute</entry>
				<entry>Description</entry>
			  </row>
			</thead>
			<tbody>
			  <row>
				<entry>Password length</entry>
				<entry>
				  The minimum number of characters for a user password.
				</entry>
			  </row>

			  <row>
				<entry>Password history</entry>
				<entry>
				  The latest password changes are saved in the form of
				  hashes. These passwords can then not be used by the
				  user as a new password when setting a new
				  password. With a password history of five, for
				  example, five new passwords must be set before a
				  password can be reused.
				</entry>
			  </row>

			  <row>
				<entry>Minimum password age</entry>
				<entry>
				  The period of time set for this must have at least
				  expired since the last password change before a user
				  can reset his password again.
				</entry>
			  </row>

			  <row>
				<entry>Maximum password age</entry>
				<entry>
				  Once the saved period of time has elapsed, the
				  password must be changed again by the user the next
				  time he logs in. If the value is left blank, the
				  password is infinitely valid.
				</entry>
			  </row>

			</tbody>
		  </tgroup>
		</table>

	</section>

    <section id="user-management:Password-changes-by-users">
		<title>User self services</title>
		<section id="user-management:Password_changes_by_users_via_UMC">
			<title>Password change by user via &ucsUMC;</title>
			<para>
				In &ucsUMC;, every user can reset his password via the
				<guimenu>Change password</guimenu> module. The module can also be opened
				by selecting the <guimenu>Settings &ar; Change password</guimenu>
				entry in the top right user menu.
				To change the password, the current password must be entered first.
				The change is performed directly via the PAM stack
				(see <xref linkend="computers:Authentication__PAM"/>) and is
				then available centrally for all services.
			</para>
		</section>
		<section id="user-management:password-changes-by-users:self-service">
			<title>Password management via Self Service app</title>
			<para>
				By installing the UCS component <guimenu>Self Service</guimenu> via the
				<guimenu>App Center</guimenu>, users are enabled to take care of their
				password management without administrator interaction.
			</para>
			<para>
				The Self Service app registers one web service on the portal
				which can be accessed via a dedicated web page:
				"Change Password".
				It allows users to update their password given their old password as well as
				to reset their lost password by requesting a token to be sent to a previously registered
				contact e-mail address. The token has to be entered on the dedicated password reset web page.
			</para>
			<para>
				The design of the Self Service app can be customized via the file <filename>/usr/share/univention-self-service/www/css/custom.css</filename>.
				This file is not overwritten during an update.
			</para>
		</section>
		<section id="user-management:password-changes-by-users:contact-data">
			<title>Contact information</title>
			<para>
				Additional personal data can be stored in LDAP with the users account.
				This may include a picture, the users private address and other contact information.
				By default only administrators can modify them.
				As an alternative selected attributes may be unlocked for the user to change himself.
				The user then can do this using the Self Service app.
			</para>
			<figure id="user-self-service">
				<title>User profile self-service</title>
				<graphic scalefit="1" width="65%" align="center" fileref="illustrations44/users_self-service_profile_en.png"/>
			</figure>
			<para>
				For this the following &ucsUCRV;s must be configured:<footnote><simpara>Both <phrase>attributes</phrase> variables must match each other. The names of the attributes and their mapping can be fetch from the following command: <command><![CDATA[python -c 'from univention.admin.handlers.users.user import mapping;print("\n".join(map("{0[0]:>30s} {0[1][0]:<30s}".format, sorted(mapping._map.items()))))']]></command></simpara></footnote>
			</para>
			<variablelist>
				<varlistentry>
					<term><envar>self-service/ldap_attributes</envar></term>
					<listitem><simpara>
						This variable configured the <emphasis>LDAP</emphasis> attributes a user can modify at its own user account.
						The names of the attributes must be separated by comma.
						This variable must be set on &ucsMaster; (and &ucsBackup;s).
					</simpara></listitem>
				</varlistentry>
				<varlistentry>
					<term><envar>self-service/udm_attributes</envar></term>
					<listitem><simpara>
						This variable configured the <emphasis>UDM</emphasis> attributes a user can modify.
						The names of the attributes must be separated by comma.
						This variable must be set on the hosts, where the Self Service app is installed.
					</simpara></listitem>
				</varlistentry>
				<varlistentry>
					<term><envar>umc/self-service/profiledata/enabled</envar></term>
					<listitem><simpara>
						This variable must be set to <literal>true</literal> on all involved server systems to enable the mechanism.
					</simpara></listitem>
				</varlistentry>
			</variablelist>
		</section>
	</section>

    <section id="users:faillog">
        <title>Automatic lockout of users after failed login attempts</title>
        <para>
            By default, a user can enter her password incorrectly any number of times. To
            hinder brute force attacks on passwords, an automatic lockout for user accounts
            can be activated after a configured number of failed log-in attempts.
        </para>
        <para>
			UCS unifies various methods for user authentication and authorization. Depending
			on the installed software components, there may be different mechanisms for
			configuring and counting failed logon attempts.
        </para>
        <para>
			The three different methods are described below.
        </para>
		<section id="users:faillog-samba">
			<title>Samba Active Directory Service</title>
			<para>
				In Samba Active Directory environments, various services are provided by Samba, such as Kerberos.
				To lockout users after too many failed log-in attempts, the tool <command>samba-tool</command> can be used.
			</para>
			<para>
				<itemizedlist>
					<listitem>
						<simpara>
							<command>samba-tool domain passwordsettings show</command> shows the currently configured
							values.
						</simpara>
					</listitem>
					<listitem>
						<simpara>
							<command>samba-tool domain passwordsettings set --account-lockout-threshold=5</command>
							specifies how often a user can attempt to log in with an incorrect password before the account
							is locked.
						</simpara>
					</listitem>
					<listitem>
						<simpara>
							<command>samba-tool domain passwordsettings set --account-lockout-duration=3</command>
							specifies the number of minutes an account will be locked after too many incorrect passwords
							have been entered.
						</simpara>
					</listitem>
					<listitem>
						<simpara>
							<command>samba-tool domain passwordsettings set --reset-account-lockout-after=5</command>
							defines the number of minutes after which the counter is reset. If an account gets automatically
							unlocked after the lockout duration, the counter is not reset immediately, to keep the account
							under strict monitoring for some time. During the time window between the end of the lockout
							duration and the point when the the counter gets reset, a single attempt to log in with an
							incorrect password will lock the account immediately again.
						</simpara>
					</listitem>
				</itemizedlist>
			</para>
			<para>
				The manual unlocking of a user is done in the user administration on the tab <guimenu>Account</guimenu> by
				activating the checkbox <guimenu>Unlock account</guimenu>.
			</para>
		</section>
		<section id="users:faillog-pam">
			<title>PAM-Stack</title>
			<para>
				The automatic locking of users after failed logons in the PAM stack can be enabled by setting the
				&ucsUCRV; <envar>auth/faillog</envar> to <literal>yes</literal>. The upper limit of failed log-in attempts
				at which an account lockout is configured in the &ucsUCRV; <envar>auth/faillog/limit</envar>.
				The counter is reset each time the password is entered correctly.
			</para>
			<para>
				The lockout is activated locally per system by default. In other words, if a
				user enters her password incorrectly too many times on one system, she can
				still login on another system. Setting the &ucsUCRV; <envar>auth/faillog/lock_global</envar>
				will make the lock effective globally and register it in the LDAP directory. The global
				lock can only be set on &ucsMaster;/Backup systems as other
				system roles do not have the necessary permissions in the LDAP
				directory. On all systems with any of these system roles, the lockout gets automatically activated locally or
				deactivated again via the listener module, depending on the current lock state in the LDAP directory.
			</para>
			<para>
				As standard, the lockout is not subject to time limitations and must be reset by
				the administrator. However, it can also be reset automatically after a certain
				time interval has elapsed. This is done by specifying a time period in seconds
				in the &ucsUCRV; <envar>auth/faillog/unlock_time</envar>. If the value is set to 0, the lock is
				reset immediately.
			</para>
			<para>
				By default, the <systemitem class="username">root</systemitem> user is excluded from the password lock, but can also be
				subjected to it by setting the &ucsUCRV; <envar>auth/faillog/root</envar> to <literal>yes</literal>.
			</para>
			<para>
				If accounts are only locked locally, the administrator can unlock a user account by entering the command
				<command>faillog -r -u USERNAME</command>. If the lock occurs globally in the LDAP directory, the user can be reset
				in Univention Management Console on the tab <guimenu>Account</guimenu> in the user options
				<guimenu>Unlock account</guimenu>.
			</para>
		</section>
		<section id="users:faillog-openldap">
			<title>OpenLDAP</title>
			<para>
				On domain controllers, automatic account locking can be enabled for too many failed LDAP server logon attempts.
				The MDB LDAP backend must be used. This is the default backend since UCS 4, previous systems must be
				migrated to the MDB LDAP backend, see <biblioref linkend="ucs-performance-guide"/>.
			</para>
			<para>
				Automatic account locking must be enabled for each domain controller. To do this,
				the &ucsUCRV;s <envar>ldap/ppolicy</envar> and <envar>ldap/ppolicy/enabled</envar> must be set to
				<envar>yes</envar> and the OpenLDAP server must be restarted:
				<programlisting language="sh">
ucr set ldap/ppolicy=yes ldap/ppolicy/enabled=yes
/etc/init.d/slapd restart
				</programlisting>
			</para>
			<para>
				The default policy is designed so that five repeated failed LDAP server logon attempts within five minutes
				cause the lockout. A locked account can only be unlocked by a domain administrator via &ucsUMC;.
			</para>
			<para>
				The number of repeated failed LDAP server logon attempts can be adjusted in the configuration object with the
				<envar>objectClass</envar> <envar>pwdPolicy</envar>:
				<programlisting language="sh">
univention-ldapsearch objectclass=pwdPolicy
				</programlisting>
				The <envar>pwdMaxFailure</envar> attribute determines the number of LDAP authentication errors before locking.
				The <envar>pwdMaxFailureCountInterval</envar> attribute determines the time interval in seconds that is considered.
				Failed logon attempts outside this interval are ignored in the count.
			</para>
			<para>
				The following command can be used to block the account after 10 attempts:
				<programlisting language="sh">
ldapmodify -x -D cn=admin,$(ucr get ldap/base) -y /etc/ldap.secret &lt;&lt;__EOT__
dn: cn=default,cn=ppolicy,cn=univention,$(ucr get ldap/base)
changetype: modify
replace: pwdMaxFailure
pwdMaxFailure: 10
__EOT__
				</programlisting>
			</para>
			<para>
				The manual unlocking of a user is done in the user administration on the tab <guimenu>Account</guimenu> by
				activating the checkbox <guimenu>Unlock account</guimenu>.
			</para>
		</section>
    </section>

    <section id="users:templates">
        <title>User templates</title>
        <para>
            A user template can be used to preset settings when creating a user.
            If at least one user template is defined, it can be selected when creating a user.
        </para>
        <figure id="user-create-template">
            <title>Selecting a user template</title>
            <graphic scalefit="1" width="70%" align="center" fileref="illustrations44/users_usertemplate_en.png"/>
        </figure>
        <para>
            User templates are administrated in the UMC module <guimenu>LDAP directory</guimenu>.
            There one needs to switch to the
            <uri>univention</uri> container and then to the <uri>templates</uri>
            subcontainer. A new user template can be created here via the
            <guimenu>Add</guimenu> with the object type
            <guimenu>Settings: User template</guimenu>.
        </para>
        <para>
            In a user template, either a fixed value can be specified (e.g., for
            the address) or an attribute of the user management
            referenced. Attributes are then referenced in chevrons.
        </para>
        <para>
            A list of possible attributes can be displayed with the command:
        </para>
            <programlisting language="sh">
univention-director-manager users/user
            </programlisting>
        <para>
            in the section <emphasis>users/user variables</emphasis> of the output.
        </para>
        <para>
            If a user template is used for adding a user, this template will
            overwrite all the fields with the preset values of the template. In
            doing so, an empty field is set to "".
        </para>
        <para>
            It is also possible to only use partial values of attributes or
            convert values in uppercase/lowercase.
        </para>

        <para>
		  For example, the UNIX home directory can be stored under
		  <filename class="directory">/home/&lt;title&gt;.&lt;lastname&gt;</filename> or the primary e-mail address
		  can be predefined with
		  <userinput>&lt;firstname&gt;.&lt;lastname&gt;@company.com</userinput>. Substitutions are
		  generally possibly for any value, but there is no syntax or semantics check. So, if no
		  first name is specified when creating a user, the above e-mail address would begin with a
		  dot and would thus be invalid according to the e-mail standard. Similar sources of error
		  can also occur when handling file paths etc. Non-resolvable attributes (for instance due
		  to typing errors in the template) are deleted.
		</para>

        <para>
		  If only a single character of an attribute is required instead of the complete attribute
		  value, the index of the required character can be entered in the user template in square
		  parentheses after the name of the attribute. The count of characters of the attribute begins
		  with 0, so that index 1 corresponds to the second character of the attribute
		  value. Accordingly, <userinput>&lt;firstname&gt;[0].&lt;lastname&gt;@company.com</userinput>
		  means an e-mail address will consist of the first letter of the first name plus the lastname.
		</para>

        <para>
		  A substring of the attribute value can be defined by entering a range in square
		  parentheses. In doing so, the index of the first required character and the index of the last
		  required character plus one are to be entered. For example, the input
		  <userinput>&lt;firstname&gt;[2:5]</userinput> returns the third to fifth character of the
		  first name.
		</para>

        <para>
		  Adding <literal>:lower</literal> or <literal>:upper</literal> to the
		  attribute name converts the attribute value to lowercase or uppercase, e.g.,
		  <userinput>&lt;firstname:lower&gt;</userinput>. If a modifier like
		  <literal>:lower</literal> is appended to the entire field, the complete value is
		  transformed, e.g. <userinput>&lt;lastname&gt;@company.com&lt;:lower&gt;</userinput>.
		</para>

        <para>
		  The option <literal>:umlauts</literal> can be used to convert special characters
		  such as è, ä or ß into the corresponding ASCII characters.
		</para>

		<para>
		The option <literal>:alphanum</literal> can be used to remove all non alphanumeric characters such as ` or #.
		A whitelist of characters that are ignored by this option can be defined in the UCR variable <envar>directory/manager/templates/alphanum/whitelist</envar>.
		If this option is applied to an entire field, even manually placed symbols like the @ in an email address are removed. To avoid that,
		this option should be applied to specific attributes only or desired symbols should be entered into the whitelist.
		</para>

        <para>
			The options <literal>:strip</literal> or <literal>:trim</literal> remove all white space characters from the start and end of the string.
		</para>

        <para>
		  It is also possible to combine options, e.g: <literal>:umlauts,upper</literal>.
      </para>
  </section>
</chapter>
